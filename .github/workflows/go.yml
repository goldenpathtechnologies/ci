name: Go

on:
  push:
    branches: [ sdlc ]
#    branches: [ main ]
#  pull_request:
#    branches: [ main ]

env:
  BUILD_OWNER: "Golden Path Technologies Inc."
  APP_NAME: ci

jobs:

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.17

      - name: Get build date
        run: echo "BUILD_DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")" >> $GITHUB_ENV

      - name: Get build version
        run: echo "BUILD_VERSION=$(cat .version)" >> $GITHUB_ENV

      - name: Build
        run: |
          go build -gcflags="all=-N -l" -ldflags \
          "-X 'main.BuildVersion=${{env.BUILD_VERSION}}' -X 'main.BuildDate=${{env.BUILD_DATE}}' -X 'main.BuildOwner=${{env.BUILD_OWNER}}'" \
          -tags forceposix \
          -o ./bin/${{APP_NAME}}

      - name: Upload binary
        uses: actions/upload-artifact@v2
        with:
          name: ci-app
          path: ./bin/ci

#      - name: Test
#        run: go test -v ./...

#  build-windows:
#    runs-on: windows-latest
#    steps:
#      - uses: actions/checkout@v2
#
#      - name: Set up Go
#        uses: actions/setup-go@v2
#        with:
#          go-version: 1.17
#
#      - name: Build
#        run: go build -v ./...

#      - name: Test
#        run: go test -v ./...
